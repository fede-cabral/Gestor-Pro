<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FORJAX PRO TITANIUM</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            background-color: #0b0e14;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            height: 100dvh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        /* PANELES */
        .panel {
            background: #151a23;
            border: 1px solid #2a3441;
            border-radius: 8px;
        }

        /* TEXTO DE MERCADO */
        .up { color: #10b981; }
        .down { color: #f43f5e; }

        /* BOTONES DEL FOOTER (SOLIDOS) */
        .footer-btn {
            background: #1e293b;
            border: 1px solid #334155;
            color: #cbd5e1;
            border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 10px; font-weight: 700;
            transition: all 0.1s;
        }
        .footer-btn:active { background: #334155; color: white; transform: translateY(1px); }
        
        .btn-trade { background: #064e3b; border-color: #059669; color: #34d399; }
        .btn-trade:active { background: #059669; color: white; }

        .btn-panic { background: #4c0519; border-color: #be123c; color: #fda4af; }
        .btn-panic.active { background: #e11d48; color: white; animation: pulse-red 1s infinite; }

        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(225, 29, 72, 0); } 100% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0); } }

        /* MODAL DE TRADING */
        #tradeModal {
            position: fixed; bottom: -100%; left: 0; width: 100%;
            background: #111827; border-top: 1px solid #374151;
            z-index: 100; transition: bottom 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            padding: 20px; border-radius: 20px 20px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        #tradeModal.open { bottom: 0; }

        /* CAPA DE PRIVACIDAD */
        #privacyLayer {
            position: fixed; inset: 0; z-index: 200;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(15px);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #privacyLayer.active { opacity: 1; pointer-events: auto; }

    </style>
</head>
<body class="p-2">

    <div id="privacyLayer">
        <div class="text-center p-8 bg-[#111] border border-red-900 rounded-2xl w-64">
            <i data-lucide="lock" class="w-12 h-12 text-red-600 mx-auto mb-4"></i>
            <h2 class="text-xl font-bold text-white mb-6">SECURE MODE</h2>
            <button onclick="togglePanic()" class="w-full bg-red-600 hover:bg-red-500 text-white py-3 rounded-lg font-bold">DESBLOQUEAR</button>
        </div>
    </div>

    <header class="flex justify-between items-center h-10 mb-2">
        <div class="flex items-center gap-2">
            <div class="bg-indigo-600/20 p-1.5 rounded text-indigo-400 border border-indigo-600/30">
                <i data-lucide="terminal" class="w-4 h-4"></i>
            </div>
            <div>
                <h1 class="text-xs font-bold text-slate-200">FORJAX <span class="text-indigo-400">PRO</span></h1>
                <div class="flex items-center gap-1">
                    <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                    <span class="text-[9px] text-emerald-500 font-mono tracking-wider">LIVE DATA</span>
                </div>
            </div>
        </div>
        <div class="text-right">
            <p id="clock" class="text-sm font-bold text-white mono">00:00:00</p>
        </div>
    </header>

    <div class="grid grid-cols-3 gap-2 mb-2 h-16">
        <div class="panel p-2 flex flex-col justify-center">
            <span class="text-[9px] text-slate-400 font-bold">USD BLUE</span>
            <span id="dolarVal" class="text-sm font-bold text-white mono mt-1">...</span>
        </div>
        <div class="panel p-2 flex flex-col justify-center">
            <span class="text-[9px] text-slate-400 font-bold">BITCOIN</span>
            <span id="btcVal" class="text-sm font-bold text-white mono mt-1">...</span>
            <span id="btcPct" class="text-[9px] mono">...</span>
        </div>
        <div class="panel p-2 flex flex-col justify-center border-l-2 border-indigo-500">
            <span class="text-[9px] text-indigo-300 font-bold">NET WORTH</span>
            <span id="netVal" class="text-sm font-bold text-white mono mt-1">...</span>
        </div>
    </div>

    <div class="panel flex-1 relative mb-2 overflow-hidden">
        <div class="absolute top-2 left-2 z-10 flex gap-2">
            <span class="text-[9px] font-bold text-white bg-black/50 px-2 py-1 rounded border border-slate-700">BTC/USD</span>
        </div>
        <div id="chartContainer" class="w-full h-full"></div>
    </div>

    <div class="grid grid-cols-2 gap-2 h-24 mb-2">
        <div class="panel p-2 overflow-hidden flex flex-col">
            <div class="flex justify-between text-[9px] text-slate-500 mb-1 font-bold border-b border-slate-700 pb-1">
                <span>PRICE</span><span>SIZE</span>
            </div>
            <div id="orderBook" class="flex-1 flex flex-col gap-0.5 text-[9px] mono"></div>
        </div>
        <div class="panel p-2 flex flex-col justify-between">
            <div>
                <span class="text-[9px] text-slate-400 font-bold">24H VOLUME</span>
                <p class="text-sm text-white mono font-bold">34.2B</p>
            </div>
            <div>
                <span class="text-[9px] text-slate-400 font-bold">SESSION P&L</span>
                <p class="text-sm text-emerald-400 mono font-bold">+0.8%</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-4 gap-2 h-12">
        <button onclick="location.reload()" class="footer-btn">
            <i data-lucide="refresh-cw" class="w-4 h-4 mb-1"></i>
            SYNC
        </button>
        <button id="btnPanic" onclick="togglePanic()" class="footer-btn btn-panic">
            <i data-lucide="eye-off" class="w-4 h-4 mb-1"></i>
            HIDE
        </button>
        <button onclick="openTrade()" class="footer-btn btn-trade">
            <i data-lucide="arrow-left-right" class="w-4 h-4 mb-1"></i>
            TRADE
        </button>
        <button onclick="window.location.href='index.html'" class="footer-btn text-rose-400 border-rose-900/30">
            <i data-lucide="log-out" class="w-4 h-4 mb-1"></i>
            EXIT
        </button>
    </div>

    <div id="tradeModal">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-bold text-white">QUICK TRADE</h3>
            <button onclick="closeTrade()" class="bg-slate-800 p-1 rounded-full"><i data-lucide="x" class="w-4 h-4 text-slate-400"></i></button>
        </div>
        
        <div class="flex gap-4 mb-6">
            <div class="flex-1">
                <label class="text-[10px] text-slate-500 font-bold block mb-1">ASSET</label>
                <div class="w-full bg-slate-900 p-3 rounded-lg text-white font-bold border border-slate-700">BTC</div>
            </div>
            <div class="flex-1">
                <label class="text-[10px] text-slate-500 font-bold block mb-1">AMOUNT (USD)</label>
                <input type="number" placeholder="100" class="w-full bg-slate-900 p-3 rounded-lg text-white font-bold border border-slate-700 outline-none focus:border-indigo-500">
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <button onclick="executeTrade('buy')" class="bg-emerald-600 hover:bg-emerald-500 text-white py-4 rounded-xl font-black text-lg shadow-lg shadow-emerald-900/50">
                BUY
            </button>
            <button onclick="executeTrade('sell')" class="bg-rose-600 hover:bg-rose-500 text-white py-4 rounded-xl font-black text-lg shadow-lg shadow-rose-900/50">
                SELL
            </button>
        </div>
        <p class="text-center text-[10px] text-slate-500 mt-4 mono">SIMULATION MODE • NO REAL FUNDS MOVED</p>
    </div>

    <script>
        // CONFIG
        const user = localStorage.getItem("currentUser") || "GUEST";
        const p = user + "_";
        let isPanic = localStorage.getItem("forjax_panic_mode") === "true";
        let chart;
        let series;

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            startClock();
            loadUserData();
            initTradingView();
            fetchMarket();
            simulateOrderBook();
            
            // Panic Check
            if(isPanic) {
                document.getElementById('privacyLayer').classList.add('active');
                document.getElementById('btnPanic').classList.add('active');
            }
        });

        // --- 1. DATOS USUARIO ---
        function loadUserData() {
            const rec = JSON.parse(localStorage.getItem(p + "records")) || [];
            const inc = rec.filter(r=>r.type==='income').reduce((a,c)=>a+c.amount,0);
            const exp = rec.filter(r=>r.type==='expense').reduce((a,c)=>a+c.amount,0);
            const net = inc - exp;
            
            const fmt = (n) => "$" + n.toLocaleString('es-AR', { notation: "compact" });
            document.getElementById('netVal').innerText = fmt(net);
        }

        // --- 2. API MERCADO ---
        async function fetchMarket() {
            try {
                // Dolar
                const r1 = await fetch("https://dolarapi.com/v1/dolares/blue");
                const d1 = await r1.json();
                document.getElementById('dolarVal').innerText = `$${d1.venta}`;
                
                // BTC
                const r2 = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true");
                const d2 = await r2.json();
                document.getElementById('btcVal').innerText = `$${d2.bitcoin.usd.toLocaleString()}`;
                const chg = d2.bitcoin.usd_24h_change.toFixed(2);
                const elP = document.getElementById('btcPct');
                elP.innerText = `${chg}%`;
                elP.className = `text-[9px] mono ${chg>=0?'up':'down'}`;
            } catch(e) {}
        }

        // --- 3. CHART TRADINGVIEW (REAL) ---
        function initTradingView() {
            const container = document.getElementById('chartContainer');
            chart = LightweightCharts.createChart(container, {
                layout: { background: { type: 'solid', color: '#151a23' }, textColor: '#94a3b8' },
                grid: { vertLines: { color: '#2a3441' }, horzLines: { color: '#2a3441' } },
                crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
                rightPriceScale: { borderColor: '#2a3441' },
                timeScale: { borderColor: '#2a3441', timeVisible: true, secondsVisible: false },
            });

            series = chart.addCandlestickSeries({
                upColor: '#10b981', downColor: '#f43f5e', borderVisible: false, wickUpColor: '#10b981', wickDownColor: '#f43f5e',
            });

            // Generar velas falsas pero bonitas
            let data = [];
            let time = new Date(Date.now() - 100 * 60000).getTime() / 1000;
            let open = 96000;
            
            for (let i = 0; i < 100; i++) {
                let close = open + (Math.random() - 0.5) * 200;
                let high = Math.max(open, close) + Math.random() * 50;
                let low = Math.min(open, close) - Math.random() * 50;
                data.push({ time: time + i * 60, open, high, low, close });
                open = close;
            }
            series.setData(data);

            // Simular Live Update
            setInterval(() => {
                const last = data[data.length - 1];
                let nextClose = last.close + (Math.random() - 0.5) * 30;
                let nextHigh = Math.max(last.close, nextClose) + Math.random() * 10;
                let nextLow = Math.min(last.close, nextClose) - Math.random() * 10;
                
                // Actualizar la última vela
                series.update({
                    time: last.time + 60,
                    open: last.close, high: nextHigh, low: nextLow, close: nextClose
                });
            }, 1000);
            
            new ResizeObserver(entries => {
                if (entries.length === 0 || entries[0].target !== container) { return; }
                const newRect = entries[0].contentRect;
                chart.applyOptions({ height: newRect.height, width: newRect.width });
            }).observe(container);
        }

        // --- 4. ORDER BOOK ---
        function simulateOrderBook() {
            const el = document.getElementById('orderBook');
            setInterval(() => {
                let h = '';
                // Sells
                for(let i=0;i<3;i++) h += `<div class="flex justify-between text-rose-400"><span class="opacity-80">${(96100+i*10+Math.random()*5).toFixed(0)}</span><span>${Math.random().toFixed(3)}</span></div>`;
                h += `<div class="h-px bg-slate-800 my-0.5"></div>`;
                // Buys
                for(let i=0;i<3;i++) h += `<div class="flex justify-between text-emerald-400"><span class="opacity-80">${(96000-i*10-Math.random()*5).toFixed(0)}</span><span>${Math.random().toFixed(3)}</span></div>`;
                el.innerHTML = h;
            }, 1000);
        }

        // --- 5. TRADE MODAL ---
        function openTrade() { document.getElementById('tradeModal').classList.add('open'); }
        function closeTrade() { document.getElementById('tradeModal').classList.remove('open'); }
        
        function executeTrade(type) {
            closeTrade();
            // Simular notificación
            const color = type === 'buy' ? '#10b981' : '#f43f5e';
            const msg = type === 'buy' ? 'ORDER FILLED: BUY BTC' : 'ORDER FILLED: SELL BTC';
            
            // Usamos un alert simple pero se podria hacer un toast
            alert(`✅ ${msg}\n(Simulation Mode)`);
        }

        // --- 6. PANIC ---
        function togglePanic() {
            isPanic = !isPanic;
            localStorage.setItem("forjax_panic_mode", isPanic);
            
            const layer = document.getElementById('privacyLayer');
            const btn = document.getElementById('btnPanic');

            if(isPanic) {
                layer.classList.add('active');
                btn.classList.add('active');
                if(navigator.vibrate) navigator.vibrate(100);
            } else {
                layer.classList.remove('active');
                btn.classList.remove('active');
            }
        }

        function startClock() {
            setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
        }

    </script>
</body>
</html>
