<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORJAX BIOS v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        body {
            background-color: #000;
            color: #33ff00;
            font-family: 'VT323', monospace;
            overflow: hidden;
            margin: 0;
            height: 100vh;
            text-transform: uppercase;
            font-size: 1.2rem;
            line-height: 1.2;
            cursor: none; /* Oculta el mouse para más realismo */
        }

        /* EFECTO CRT (Monitor Viejo) */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .crt::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.6) 100%);
            z-index: 2;
            pointer-events: none;
        }

        .text-glow { text-shadow: 0 0 5px #33ff00, 0 0 10px #33ff00; }
        .text-red-glow { color: #ff0000; text-shadow: 0 0 5px #ff0000; }
        .text-yellow-glow { color: #ffff00; text-shadow: 0 0 5px #ffff00; }

        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* Scrollbar oculta pero funcional */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        
        #console { padding: 2rem; padding-bottom: 5rem; height: 100%; overflow-y: auto; }
    </style>
</head>
<body class="crt">

    <div id="console"></div>

    <script>
        // --- SONIDO DE TECLA (Opcional, muy sutil) ---
        const playBeep = () => {
            // Descomentar si querés sonido, a veces los navegadores lo bloquean sin interacción
            // const a = new AudioContext(); const o = a.createOscillator(); const g = a.createGain();
            // o.connect(g); g.connect(a.destination); o.frequency.value = 800; g.gain.value = 0.02;
            // o.start(); setTimeout(() => o.stop(), 50);
        };

        const term = document.getElementById('console');
        const user = localStorage.getItem("currentUser") || "GUEST";
        const panicState = localStorage.getItem("forjax_panic_mode") === "true";

        // --- DATOS REALES ---
        const p = user + "_";
        const rec = JSON.parse(localStorage.getItem(p + "records")) || [];
        const subs = JSON.parse(localStorage.getItem(p + "subs")) || [];
        
        const income = rec.filter(r=>r.type==='income').reduce((a,c)=>a+c.amount,0);
        const expense = rec.filter(r=>r.type==='expense').reduce((a,c)=>a+c.amount,0);
        const balance = income - expense;
        const totalSubs = subs.reduce((a,c)=>a+c.amount,0);
        
        // --- LÓGICA DE ESCRITURA ---
        const sleep = (ms) => new Promise(r => setTimeout(r, ms));

        async function print(text, style = "", delay = 20) {
            const line = document.createElement('div');
            line.className = style;
            term.appendChild(line);
            
            // Auto scroll
            window.scrollTo(0, document.body.scrollHeight);
            term.scrollTop = term.scrollHeight;

            for (let i = 0; i < text.length; i++) {
                line.innerHTML += text.charAt(i);
                // playBeep(); // Si activás el audio
                await sleep(delay);
            }
        }

        async function boot() {
            await print("FORJAX BIOS (C) 2026 FINANCIAL SYSTEMS INC.", "text-slate-500", 5);
            await print("CHECKING MEMORY: 640K OK", "", 5);
            await print("LOADING KERNEL...", "", 10);
            await sleep(500);
            await print("MOUNTING VOLUME 'WALLET'...", "", 10);
            await sleep(300);
            await print("ACCESSING NEURAL NETWORK...", "", 10);
            await sleep(800);
            
            // ASCII ART
            term.innerHTML += `<pre class="text-glow font-bold leading-none my-4">
  ______ ____  _____       _    __   __
 |  ____/ __ \\|  __ \\     | |   \\ \\ / /
 | |__ | |  | | |__) |    | | __ \\ V / 
 |  __|| |  | |  _  / _   | |/ _\\ > <  
 | |   | |__| | | \\ \\| |__| | (_| / . \\ 
 |_|    \\____/|_|  \\_\\\\____/ \\__,_/_/ \\_\\
            </pre>`;
            
            await print(`> USER DETECTED: [ ${user.toUpperCase()} ]`, "text-white font-bold");
            await print("> DECRYPTING FINANCIAL RECORDS...", "blink");
            await sleep(1500);
            
            // REMOVE BLINK
            term.lastChild.classList.remove("blink");
            term.lastChild.innerHTML = "> DECRYPTING FINANCIAL RECORDS... [OK]";

            await print("----------------------------------------");
            await print("SYSTEM DIAGNOSTICS REPORT:", "text-white underline");
            await sleep(200);

            // DATA REAL
            await print(`> TOTAL INCOME STREAMS:  $${income.toLocaleString()}`);
            await sleep(100);
            await print(`> TOTAL BURN RATE:       $${expense.toLocaleString()}`);
            await sleep(100);
            
            let balColor = balance >= 0 ? "text-glow" : "text-red-glow";
            let balText = balance >= 0 ? "OPTIMAL" : "CRITICAL FAILURE";
            await print(`> NET LIQUIDITY:         $${balance.toLocaleString()}`, balColor);
            await print(`> SYSTEM STATUS:         [ ${balText} ]`, balColor);
            
            await print(`> ACTIVE SUBSCRIPTIONS:  ${subs.length} (Impact: $${totalSubs}/mo)`);
            
            // BIO ANALISIS
            const bioStress = rec.filter(r => r.bio === 30).length;
            if (bioStress > 5) {
                await print(`> WARNING: HIGH CORTISOL LEVELS DETECTED IN SPENDING.`, "text-red-glow blink");
            } else {
                await print(`> BIO-METRICS: STABLE.`, "text-glow");
            }

            await print("----------------------------------------");
            await sleep(500);

            // MENU INTERACTIVO
            await showMenu();
        }

        async function showMenu() {
            const status = localStorage.getItem("forjax_panic_mode") === "true" ? "ACTIVE" : "INACTIVE";
            const color = status === "ACTIVE" ? "text-red-glow" : "text-slate-500";

            await print("");
            await print("COMMANDS AVAILABLE:", "text-white");
            await print(" [ESC] RETURN TO DASHBOARD (GUI)");
            await print(" [P]   TOGGLE PANIC MODE (LOCK DATA)");
            await print(" [R]   REBOOT SYSTEM (RELOAD)");
            
            await print("");
            await print(`CURRENT SECURITY PROTOCOL: [ ${status} ]`, color + " id-status");
            
            const cursor = document.createElement('div');
            cursor.innerHTML = `root@${user.toLowerCase()}:~# <span class="blink">_</span>`;
            term.appendChild(cursor);
            
            window.scrollTo(0, document.body.scrollHeight);
        }

        // --- TECLADO ---
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape") {
                document.body.style.transition = "opacity 1s";
                document.body.style.opacity = "0";
                setTimeout(() => window.location.href = "index.html", 1000);
            }
            if (e.key.toLowerCase() === "r") {
                location.reload();
            }
            if (e.key.toLowerCase() === "p") {
                const current = localStorage.getItem("forjax_panic_mode") === "true";
                const newState = !current;
                localStorage.setItem("forjax_panic_mode", newState);
                
                // Efecto visual instantáneo
                const el = document.getElementsByClassName("id-status")[0];
                if (el) {
                    if (newState) {
                        el.innerText = "CURRENT SECURITY PROTOCOL: [ ACTIVE ]";
                        el.className = "text-red-glow id-status blink";
                        print("> !!! SECURITY OVERRIDE ENABLED !!!", "text-red-glow");
                        print("> DASHBOARD DATA WILL BE MASKED.", "text-red-glow");
                    } else {
                        el.innerText = "CURRENT SECURITY PROTOCOL: [ INACTIVE ]";
                        el.className = "text-glow id-status";
                        print("> SECURITY PROTOCOL DISENGAGED.", "text-glow");
                        print("> DASHBOARD DATA VISIBLE.", "text-slate-500");
                    }
                }
            }
        });

        // INICIAR
        boot();

    </script>
</body>
</html>
